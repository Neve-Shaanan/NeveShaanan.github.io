import{a as pe,b as Me,c as v,d as j}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-JWGHTXKT.js";import{a as fe,b as je}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-G26255YO.js";import{a as me,b as ze}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-GDHUHRCU.js";import{a as ue,b as De}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-BPLMQ7B2.js";import{a as ce,b as Ee}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-QEHHZFGW.js";import{d as J,g as Le,i as Oe,j as Q,l as ee,m as E,n as te,p as ie,q as M,r as re,s as Ie}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-J3BGDRJM.js";import{d as ne,e as ae,f as le,o as Re}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-72MKFQGT.js";import{b as D,c as oe,e as se}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-FMWU7B22.js";import{l as g,m as R,w as K,x as Pe}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-UDEESYNX.js";import{a as $,h as Ae}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-TR6BGY3W.js";import{b as G,h as ke}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-GUAW3NSU.js";import{b as F,h as N,j as U,p as V,s as X,u as Y,z as L}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-U334KKIN.js";import{a as Z,c as Se,d as I,m as q,n as m,o as W}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-55VYORUF.js";import{b as O}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-UB3G6XPO.js";import{a as b,c as P}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-E3FYFF3U.js";import{a as h,f as a}from"https://st-p.rmcdn.net/af2666fc/dist/c/c-UGUCNLQ2.js";var de=h(()=>{"use strict"});var S,T,z,he=h(()=>{"use strict";De();Me();L();P();S=class S{constructor(){a(this,"observer",null);a(this,"observedElements",new Map);a(this,"handleResize",N(i=>{for(let e of i){let r=this.observedElements.get(e.target);if(r){let{top:o,left:s,width:p,height:c}=e.contentRect;r({top:o,left:s,width:p,height:c})}}},20));pe(this),!b()&&(this.observer=new ue(this.handleResize))}observe(i,e){this.observedElements.set(i,e),this.observer?.observe(i)}unobserve(i){this.observedElements.delete(i),this.observer?.unobserve(i)}static getInstance(){return this._instance||(this._instance=new S),this._instance}};a(S,"_instance",null);T=S,z={observe(t,i){T.getInstance().observe(t,i)},unobserve(t){T.getInstance().unobserve(t)}}});var _,ge=h(()=>{"use strict";j();Re();he();_=class extends v{constructor(){super();a(this,"ref",null);a(this,"offset",{top:0,left:0,width:0,height:0});a(this,"rect",{top:0,left:0,width:0,height:0})}setElement(e){if(e===null||this.ref===e)return;let r=this.ref;r&&z.unobserve(r),this.ref=this.detach(e),this.ref&&(this.offset=this.calculateOffsets(),this.rect=le(e),z.observe(this.ref,o=>{this.offset=this.calculateOffsets(),this.rect=o}))}calculateOffsets(){return this.ref?{width:this.ref.offsetWidth,height:this.ref.offsetHeight,top:ne(this.ref),left:ae(this.ref)}:{width:0,height:0,top:0,left:0}}}});var k,w,C,be=h(()=>{"use strict";Ae();je();P();se();k=class k{constructor(){a(this,"elementsVisibility",new Map);a(this,"primaryObserver",null);a(this,"secondaryObserver",null);a(this,"primaryObserverMargin",0);a(this,"secondaryObserverMargin",0);a(this,"entriesLoop",(i,e,r)=>{for(let o of i){let s=this.elementsVisibility.get(o.target);s&&((o.isIntersecting||o.intersectionRatio>0)&&e(s),o.intersectionRatio<=0&&r(s))}});a(this,"handlePrimaryVisibility",i=>{this.entriesLoop(i,e=>{e.isVisible||(e.isVisible=!0,e.wasVisible=!0)},e=>{e.isVisible&&(e.isVisible=!1)})});a(this,"handleSecondaryVisibility",i=>{this.entriesLoop(i,e=>{e.aboutToShow||(e.aboutToShow=!0)},e=>{e.aboutToShow&&(e.aboutToShow=!1)})});b()||(this.primaryObserver=new IntersectionObserver(this.handlePrimaryVisibility,{root:document,rootMargin:D(this.primaryObserverMargin)}),this.secondaryObserverMargin=b()?0:window.innerHeight*.25,this.secondaryObserver=new IntersectionObserver(this.handleSecondaryVisibility,{root:document,rootMargin:D(this.secondaryObserverMargin)}))}observe(i,e=!1){let r=$({isVisible:e,wasVisible:e,aboutToShow:e});return this.elementsVisibility.set(i,r),this.primaryObserver?.observe(i),this.secondaryObserver?.observe(i),r}unobserve(i){this.elementsVisibility.delete(i),this.primaryObserver?.unobserve(i),this.secondaryObserver?.unobserve(i)}static getInstance(){return this._instance||(this._instance=new k),this._instance}};a(k,"_instance",null);w=k,C={observe(t,i){return w.getInstance().observe(t,i)},observeMultiple(t,i){let e=w.getInstance(),r=t.map(o=>e.observe(o,i));return fe({isVisible:o=>r.some(s=>o(s).isVisible),wasVisible:o=>r.some(s=>o(s).wasVisible),aboutToShow:o=>r.some(s=>o(s).aboutToShow)})},unobserve(t){let i=w.getInstance(),e=Array.isArray(t)?t:[t];for(let r of e)i.unobserve(r)}}});var A,ye=h(()=>{"use strict";O();Oe();j();ke();Se();A=class extends v{constructor(e){super();a(this,"project");a(this,"linkData",null);this.project=e.project,this.linkData=this.getLinkData(e.widget.model),this.project.subscribe("pages",()=>{this.linkData=this.getLinkData(e.widget.model)})}doesWidgetHasLink(e){return["button","picture","shape",Z("widget.lottieLinks")?"lottie":null].includes(e.type)}getLinkData(e){if(!e||!this.doesWidgetHasLink(e)||!e.clickLink)return null;if(e.clickLink?.toLowerCase()==="__rm_anchor")return{type:"Anchor",target:e.clickTarget,url:`${e.anchor_link_pos}px`,anchorPosition:e.anchor_link_pos,pageId:e.clickPage,closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("mailto:"))return{type:"Email",target:e.clickTarget,url:e.clickLink.toLowerCase().replace("mailto:",""),closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("tel:"))return{type:"Phone",target:e.clickTarget,url:e.clickLink.toLowerCase().replace("tel:",""),closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("back to top"))return{type:"ScrollToTop",url:"",closeTip:e.closeTip};if(e.clickLink?.toLowerCase()==="__rm_goback")return{type:"GoBack",url:"",closeTip:e.closeTip};if(this.project.getPageNum(e.clickLink)){let r=this.project.getPageNum(e.clickLink);return{type:"Page",target:e.clickTarget,pageId:e.clickLink,url:r?`${r}`:"",closeTip:e.closeTip}}else if(G(e.clickLink))return{type:"URL",target:e.clickTarget,url:e.clickLink,closeTip:e.closeTip};return null}}});function x(t){switch(t){case"phone_portrait":return"viewport_phone_portrait";case"tablet_portrait":return"viewport_tablet_portrait";default:return"viewport_default"}}function He(t,i){let e=x(i);if(e!=="viewport_default"){let r=t[e];if(r&&Object.keys(r).length>0)return t[e]}return t}function At(t,i){let e=He(t,i);return e&&e.height?e.height:t.height}function Pt({pageViewport:t,desktopWidth:i,phoneWidth:e}){return!t||t==="default"?i||m.dictionary.default.width:t==="phone_portrait"?e||m.dictionary.phone_portrait.width:m.dictionary[t].width}var ve=h(()=>{"use strict";W()});function Nt(t){if(typeof t=="number"&&t!==0){let i=Math.PI/180*t;return{angle:t,radians:i,cos:Math.cos(i),sin:Math.sin(i)}}return null}function Fe({rotation:t,point:i,origin:e}){if(!t||V(t))return i;let{cos:r,sin:o}=t;if(e){let c={x:e.left+e.width/2,y:e.top+e.height/2},d=c.x+(i.x-c.x)*r-(i.y-c.y)*o,u=c.y+(i.x-c.x)*o+(i.y-c.y)*r;return{x:d,y:u}}let s=r*i.x+o*i.y,p=r*i.y-o*i.x;return{x:s,y:p}}function xe(t){return typeof t=="string"?t:t===!0?"swing":null}function Ut(t){let i=t.loop||(t.steps.length?t.steps[0].loop:void 0);if(i){let e=xe(i);if(e)return{startIndex:0,value:e}}else{let e=t.steps.findIndex((r,o)=>o!==0&&r.loop);if(e>-1){let r=t.steps[e],o=xe(r?.loop);if(r&&o)return{startIndex:e,value:o}}}return null}function Xt(t){return t?.steps.length&&t.steps[0].startWhenInView||!1}function Ne(t){return!t||V(t)||V(t.steps)||!t.type||t.type==="none"}function _e(t){let i=t.animation,e=i&&!Array.isArray(i)?[i]:i||[];if(!e?.length)return;let r=!!t.fixed_position,o=t.is_full_width,s=t.is_full_height,p=!r&&!o&&!s,c=[];for(let d of e){if(Ne(d))continue;let u=g(d);if(p||(u.UUID=qe(JSON.stringify(u))),u.trigger){let f=u.trigger;u.trigger=f&&!Array.isArray(f)?[f]:f||[]}let y=[],l={dx:0,dy:0,from_opacity:100,opacity:100,from_rotate:0,rotate:0,from_scale:100,scale:100};for(let f=0;f<u.steps.length;f++){let n=g(u.steps[f]);(!n.use_bezier||n.use_bezier&&!n.curve)&&(n.curve={}),n.curve&&!n.curve.c1&&(n.curve.c1={x:l.dx??0,y:l.dy??0}),n.use_move?(l.dx=n.dx,l.dy=n.dy):(n.dx=l.dx,n.dy=l.dy),n.curve&&!n.curve.c2&&(n.curve.c2={x:n.dx??0,y:n.dy??0}),n.use_opacity?(l.from_opacity=n.from_opacity,l.opacity=n.opacity):(n.from_opacity=l.from_opacity,n.opacity=l.opacity),n.use_scale?(l.from_scale=n.from_scale,l.scale=n.scale):(n.from_scale=l.from_scale,n.scale=l.scale),n.use_rotate?(l.from_rotate=n.from_rotate,l.rotate=n.rotate):(n.from_rotate=l.from_rotate,n.rotate=l.rotate),o&&(n.dx=0,n.rotate=0,n.from_rotate=0),s&&(n.dy=0,n.rotate=0,n.from_rotate=0),u.type==="scroll"&&!r&&f===0&&(n.delay_px=0),f!==0&&(delete n.from_opacity,delete n.from_rotate,delete n.from_scale),y.push(n)}y.length&&c.push({...u,steps:y})}if(c.length)return Ue(c)}function B(t,i){let e={...t};if(i.rotation?.angle!==0){let{x:r,y:o}=Fe({rotation:i.rotation,point:{x:t.x??0,y:t.y??0}});e.x=r,e.y=o}return i.flipX&&e.x!==0&&(e.x*=-1),i.flipY&&e.y!==0&&(e.y*=-1),e}function Yt(t,i){let e=[];for(let r of t.steps){let o={...r},{x:s,y:p}=B({x:o.dx??0,y:o.dy??0},i);o.dx=s,o.dy=p,typeof o.from_rotate=="number"&&o.from_rotate!==0&&(i.flipX&&(o.from_rotate*=-1),i.flipY&&(o.from_rotate*=-1)),typeof o.rotate=="number"&&o.rotate!==0&&(i.flipX&&(o.rotate*=-1),i.flipY&&(o.rotate*=-1)),o.curve={c1:B(r.curve.c1,i),c2:B(r.curve.c2,i)},e.push(o)}return{...t,steps:e}}function Ue(t){let i=["click","hover","scroll","load","moveOnly","nonMove"];function e(r){return r.steps?.every(o=>o.use_move&&!o.use_scale&&!o.use_rotate)?"moveOnly":r.steps?.every(o=>!o.use_move)?"nonMove":r.type}return t.sort((r,o)=>i.indexOf(e(r))-i.indexOf(e(o)))}function Zt(t){return t?.length?t.some(i=>i.type==="click"):!1}function qt(t){return t?.length?t.some(i=>i.type==="hover"):!1}function Gt(t){return t?.length?t.some(i=>i.type==="scroll"):!1}function $t(t){return t?.length?t.some(i=>i.steps?.some(e=>e.use_rotate||e.use_move||e.use_scale)):!1}function Kt(t){return t?.length?t.some(i=>i.steps?.some(e=>e.use_opacity)):!1}function Xe(t=[]){return!!t.find((e,r)=>e.use_rotate&&(r===0&&e.from_rotate!==0||e.rotate!==0))}function Ye(t=[]){return!!t.find((e,r)=>e.use_scale&&(r===0&&e.from_scale!==100||e.scale!==100))}function Jt(t=[]){let i=J()?K().animationType==="bezier":!0,e=typeof window<"u"?window.CSS.supports('(offset-path: path("M 0,0")) and (offset-rotate: 0deg) and (offset-distance: 1px)'):!0,r=Ze();return!i||!e?!1:r?!Xe(t)&&!Ye(t):!0}function Qt(t,i){let e={};return i==="from"?(t.use_move&&(e.x=0,e.y=0),t.use_rotate&&typeof t.from_rotate=="number"&&(e.rotate=t.from_rotate),t.use_scale&&typeof t.from_scale=="number"&&(e.scale=t.from_scale/100),t.use_opacity&&typeof t.from_opacity=="number"&&(e.opacity=t.from_opacity/100)):(t.use_move&&(typeof t.dy=="number"&&(e.y=t.dy),typeof t.dx=="number"&&(e.x=t.dx)),t.use_rotate&&typeof t.rotate=="number"&&(e.rotate=t.rotate),t.use_scale&&typeof t.scale=="number"&&(e.scale=t.scale/100),t.use_opacity&&typeof t.opacity=="number"&&(e.opacity=t.opacity/100)),typeof e.opacity!="number"&&(e.opacity=1),typeof e.rotate!="number"&&(e.rotate=0),typeof e.scale!="number"&&(e.scale=1),typeof e.x!="number"&&(e.x=0),typeof e.y!="number"&&(e.y=0),e}function ei(t,i,e){let r={},o=Y(t,e?["scale","rotate"]:["x","y","scale","rotate"]);return Object.keys(o).length&&(r.transform=oe(o,!0)),typeof t.opacity=="number"&&(r.opacity=t.opacity,r.opacity===0&&!i?r.visibility="hidden":r.visibility="visible"),r}function qe(t){let i=0;for(let e=0;e<t.length;e++){let r=t.charCodeAt(e);i=(i<<5)-i+r,i|=0}return String(Math.abs(i))}var Ze,we=h(()=>{"use strict";O();L();R();se();Le();Pe();Ze=()=>{let t=typeof window<"u"?window.navigator.userAgent:"";if(/ Safari\//.test(t)&&!/ Chrom/.test(t)){let i=navigator.userAgent.match(/ Version\/(\d+)/)??[];return i[1]?Number(i[1])<=15:!1}else return!1}});function Ge(t,i,e){let r=i[m.globalPrefix+t]||[],o=r.find(s=>s.pid===e)||r.find(s=>s.pid==="default");return!o||o.value===void 0?i[t]:o.value}function H(t,i){let e=g(t);for(let r of m.globalKeys)if(e[`${m.globalPrefix}${r}`]){let o=Ge(r,e,i);typeof o<"u"&&(e[r]=o)}return e}var Ve=h(()=>{"use strict";W();R()});var We,Te,Si,ki,Ai,$e=h(()=>{"use strict";O();W();W();L();R();de();j();ge();be();ye();Ee();ve();Ie();we();Ve();P();ze();We=99999,Te=class t extends v{constructor(e){super();a(this,"currentViewport");a(this,"_model");a(this,"model");a(this,"element");a(this,"animationElement");a(this,"visibility");a(this,"link");a(this,"triggersStore");a(this,"animationsStore");a(this,"zIndexStore");a(this,"hasViewports",!1);a(this,"isWidgetTrigger");this.triggersStore=e.triggersStore,this.animationsStore=e.animationsStore,this.zIndexStore=e.zIndexStore,this.currentViewport=e.pageMeta?.state.currentViewport||e.project.projectViewport.value,this.element=this.detach(new _),this.animationElement=this.detach(new _),this._model=this.prepareWidgetData(e.widget),this.model=this._model,this.computeWidgetModel(),this.isWidgetTrigger=this.triggersStore.isWidgetTrigger(this.model._id),this.visibility=this.getInitialVisibility(),this.bindViewportListener(e.project.projectViewport,e.pageMeta),this.bindElementListener(),this.bindTriggersListener(),this.animationsStore.addWidget({widgetId:this.model._id,animations:this.model.animation||[],rotation:this.model.angle,flipX:!!this.model.flip_h,flipY:!!this.model.flip_v,rect:{width:this.model.is_full_width?this.model.full_width_initial_w||this.model.w:this.model.w,height:this.model.is_full_height?this.model.full_height_initial_h||this.model.h:this.model.h,top:this.model.is_full_height?this.model.full_height_initial_y||this.model.y:this.model.y,left:this.model.is_full_width?this.model.full_width_initial_x||this.model.x:this.model.x}}),this.link=new A({widget:this,project:e.project})}bindElementListener(){let e=()=>{let r=[this.element.ref,this.animationElement.ref].filter(Boolean);return r.length&&C.unobserve(r),C.observeMultiple(r,this.visibility.isVisible)};this.element.subscribe("ref",()=>{this.element.ref&&((this.model.is_full_height||this.model.is_full_width)&&(this.animationsStore.updateWidgetRect(this.model._id,this.element.rect),this.element.subscribe("rect",r=>{this.animationsStore.updateWidgetRect(this.model._id,r)})),this.visibility=e(),this.triggersStore.bindTriggerElement(this.model._id,this.element.ref))}),this.animationElement.subscribe("ref",()=>{this.animationElement.ref&&(this.visibility=e())})}bindTriggersListener(){this.triggersStore.subscribe(()=>{this.isWidgetTrigger=this.triggersStore.isWidgetTrigger(this.model._id)})}addTriggerCallback(e){return this.triggersStore.addTriggerCallback({...e,responderWidgetId:this.model._id})}bindViewportListener(e,r){r?(this.currentViewport=r.state.currentViewport,r.subscribe("state.currentViewport",o=>{this.currentViewport=o,this.computeWidgetModel()})):(this.currentViewport=e.value,e.subscribe("value",o=>{this.currentViewport=o,this.computeWidgetModel()}))}computeWidgetModel(){let e=this.currentViewport;this.model=this.getViewportData(e),this.hasViewports=this.calculateHasViewports()}getViewportData(e){let r=x(e);return e==="default"||!this.hasViewport(e)?this._model:{...this._model,...this._model[r]}}setViewportWidgetState(e){let r=this.currentViewport,o=this._model;if(typeof e.z=="number"&&this.zIndexStore.setZIndex(this._model._id,e.z),r==="default")Object.assign(this._model,{...e});else{let s=x(r);Object.assign(this._model,{[s]:{...o[s]||{},...e}})}this.computeWidgetModel()}prepareWidgetData(e){let r=g(e);return q(r,(o,s)=>{if(!o)return;let p=t.getWidgetViewportData(r,s,r.pid);for(let c of m.globalKeys)typeof p?.[c]<"u"&&(o[c]=p[c]);"animation"in o&&(o.animation=_e(o)),Q(o)&&Object.assign(o,me(o))}),r}isHiddenInViewport(e=this.currentViewport){let r=this.getViewportData(e);return!!(!r||r.hidden)}hasViewport(e){let r=x(e);return r==="viewport_default"?!0:r in this._model&&Object.keys(this._model[r]).length>0}calculateHasViewports(){return Object.values(I).some(e=>!this.isHiddenInViewport(e))}moveTo(e){this.setViewportWidgetState(e)}zIndexToTop(){this.setViewportWidgetState({z:this.model.z+We})}zIndexResetToNormal(){this.setViewportWidgetState({z:this.model.z-We})}setTopmostZIndex(){this.setViewportWidgetState({z:this.zIndexStore.getTopmostZIndex()+1})}getInitialVisibility(){let e={height:b()?2e3:window.outerHeight,width:b()?2e3:window.outerWidth,left:0,top:0};if(["background","rmheader"].includes(this.model.type))return{isVisible:!0,wasVisible:!0,aboutToShow:!0};let r=ce.isPointInBox({left:this.model.x,top:this.model.y},e);return{isVisible:r,wasVisible:r,aboutToShow:r}}static getWidgetViewportData(e,r,o){let s=g(e);if(M(s)||re(s))return s;let p=x(r);if(p in s){let c=g(s),d={},u=Object.keys(s[p]);for(let l of u){if(te(s)&&(l==="borders"||l==="weight"||l==="bg_color")||E(s)&&l==="picture"||ee(s)&&s.version===3&&l==="blocks")continue;let f=!1;f||(d[l]=void 0),f||(d[l]=ie(s)&&!s[p][l]&&U(m.viewport_fields.button,m.viewport_fields_common).includes(l)?s[l]:void 0)}let y=F(c,d,X(s[p],["_id","modelType"]));return y.is_global?H(y,o):y}else if(r==="default")return s.is_global?H(s,o):s;return null}static canUseWidgetForLayerType(e,r){if(!e)return!1;if(E(e)&&r==="fixed"||M(e))return!0;let o=e?.fixed_position&&r==="regular",s=!e?.fixed_position&&r==="fixed";return!o&&!s}},{useSnapshot:Si,useProxy:ki,Provider:Ai}=v.createContext()});export{Nt as a,Fe as b,Ut as c,Xt as d,Yt as e,Zt as f,qt as g,Gt as h,$t as i,Kt as j,Jt as k,Qt as l,ei as m,we as n,de as o,_ as p,ge as q,x as r,At as s,Pt as t,ve as u,H as v,Ve as w,Te as x,Si as y,Ai as z,$e as A};
